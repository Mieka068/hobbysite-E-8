{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1>Dashboard</h1>

    <!-- Tabs: per App -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button class="tab-button" onclick="showTab('commissions', this)">Commissions</button>
        <button class="tab-button" onclick="showTab('forum', this)">Forum</button>
        <button class="tab-button" onclick="showTab('wiki', this)">Wiki</button>
        <button class="tab-button" onclick="showTab('blog', this)">Blog</button>
        <button class="tab-button" onclick="showTab('merchstore', this)">Merch Store</button>
    </div>

    <!-- Commissions Tab -->
    <div id="commissions" class="tab-content">
        <h2>Commissions</h2>

        <h3>Commissions You Created</h3>
        {% if commissions_created %}
            {% for com in commissions_created %}
                <div class="commission-box">
                    <a href="{% url 'commissions:detail' com.id %}">{{ com.title }}</a> - {{ com.status }}
                </div>
            {% endfor %}
        {% else %}
            <p>You have not created any commissions yet.</p>
        {% endif %}

        <h3>Commissions You Joined</h3>
        {% if commissions_joined %}
            {% for com in commissions_joined %}
                <div class="commission-box">
                    <a href="{% url 'commissions:detail' com.id %}">{{ com.title }}</a> - {{ com.status }}
                </div>
            {% endfor %}
        {% else %}
            <p>You have not joined any commissions yet.</p>
        {% endif %}
    </div>

    <!-- Forum Tab -->
    <div id="forum" class="tab-content" style="display: none;">
        <h2>Forum Posts</h2>
        {% if user_threads %}
            {% for thread in user_threads %}
                <div class="commission-box">
                    <a href="{% url 'forum:thread_detail' thread.pk %}">{{ thread.title }}</a>
                    <small>(in {{ thread.category.name }})</small>
                </div>
            {% endfor %}
        {% else %}
            <p>No posts yet.</p>
        {% endif %}
    </div>

    <!-- Wiki Tab -->
    <div id="wiki" class="tab-content" style="display: none;">
        <h2>Wiki Contributions</h2>
        {% if wiki_articles %}
            {% for article in wiki_articles %}
                <div class="commission-box">
                    <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
                </div>
            {% endfor %}
        {% else %}
            <p>You have not made any contributions to the wiki yet.</p>
        {% endif %}
    </div>

    <!-- Blog Tab -->
    <div id="blog" class="tab-content" style="display: none;">
        <h2>Blog Posts</h2>
        {% if blog_articles %}
            {% for article in blog_articles %}
                <div class="commission-box">
                    <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
                </div>
            {% endfor %}
        {% else %}
            <p>You have not made any blog articles yet.</p>
        {% endif %}
    </div>

    <!-- Merch Store Tab -->
    <div id="merchstore" class="tab-content" style="display: none;">
        <h2>Your Listed Products</h2>
        {% if user_products %}
            {% for product in user_products %}
                <div class="commission-box">
                    <a href="{% url 'merchstore:detail_view' product.id %}">{{ product.name }}</a>
                <p>Status: {{ product.status }} | Price: ${{ product.price }} | Stock: {{ product.stock }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>You have not listed any products yet.</p>
        {% endif %}
    </div>

    <style>
        /* Tab Buttons */
        .tab-button {
            padding: 7px 14px;
            border-radius: 5px;
            border: none;
            background-color: #bdc3c7;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .tab-button:hover {
            background-color: #95a5a6;
        }

        /* Active Tab Button Styles (set via JS) */
        .tab-button.active {
            background-color: #3498db;
            font-weight: bold;
            color: white;
        }

        /* Commission-box style unified for all tabs */
        .commission-box {
            background-color: #f4f6f7;
            border: 1px solid #dcdde1;
            border-radius: 6px;
            padding: 12px 18px;
            margin-bottom: 12px;
            font-size: 1rem;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .commission-box a {
            font-weight: 600;
            text-decoration: none;
            color: #2980b9;
        }
        .commission-box a:hover {
            text-decoration: underline;
        }
        .commission-box small {
            color: #7f8c8d;
            font-style: italic;
            margin-left: 10px;
        }
    </style>

    <script>
        function showTab(tabName, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            // Show selected tab
            document.getElementById(tabName).style.display = 'block';

            // Remove 'active' class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add 'active' class to clicked button
            button.classList.add('active');
        }

        // On page load, highlight the first tab
        document.addEventListener('DOMContentLoaded', () => {
            const firstTab = document.querySelectorAll('.tab-button')[0];
            showTab('commissions', firstTab);
        });
    </script>

{% endblock %}
