{% extends 'base.html' %}
{% load static %}

{% block title %}{{ object.title }}{% endblock %}

{% block content %}
<style>
  /* Container to hold top buttons and title */
  .top-bar {
    max-width: 700px;
    margin: 20px auto 10px auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Title centered below the top bar */
  h1.article-title {
    text-align: center;
    margin-bottom: 8px;
  }

  /* Category tag centered below title */
  .category-tag {
    display: inline-block;
    background-color: #3498db;
    color: white;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 0.9em;
    font-weight: bold;
    margin: 0 auto 15px auto;
    text-align: center;
  }

  /* Created and Updated dates container */
  .dates-container {
    max-width: 700px;
    margin: 0 auto 20px auto;
    font-style: italic;
    color: #555;
    display: flex;
    justify-content: space-between;
    font-size: 0.9em;
  }

  /* Header image */
  .article-header-image {
    text-align: center;
    margin-bottom: 15px;
  }
  .article-header-image img {
    max-width: 100%;
    border-radius: 10px;
  }

  /* Author info left aligned below image */
  .author-info {
    max-width: 700px;
    margin: 0 auto 25px auto;
    font-style: italic;
    color: #555;
    font-size: 0.95em;
    text-align: left;
  }

  /* Article body styling */
  .article-body {
    max-width: 700px;
    margin: 0 auto 40px auto;
    padding: 0 15px;
    line-height: 1.6;
    font-size: 1.05em;
    white-space: normal;
    word-wrap: break-word;
  }

  /* "Want to see more like this?" section */
  .commissions-list {
    max-width: 700px;
    margin: 0 auto 40px auto;
  }

  .commission-box {
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #fafafa;
    margin-bottom: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  .commission-box a {
    font-weight: 600;
    text-decoration: none;
    color: #3498db;
    font-size: 1.1em;
  }

  /* Comments container */
  .comments {
    max-width: 700px;
    margin: 0 auto 40px auto;
  }

  /* Each comment box with padding for less cramped text */
  .comment-box {
    border-top: 1px solid #ddd;
    padding: 15px 20px;  /* increased horizontal padding */
  }

  .comment-box p {
    margin: 5px 0;
  }

  .timestamp {
    color: #999;
    font-size: 0.85em;
  }

  /* Comment form styling */
  form {
    max-width: 700px;
    margin: 20px auto 40px auto;  /* added margin-bottom to separate from comments */
  }

  /* Comment form button styling */
  form button {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    display: block;
    margin: 20px auto 0 auto;
  }
</style>

{% if view_type == 'detail' %}
  <div class="top-bar">
    <a href="{% url 'blog:article_list' %}" class="back-button">← Back to Articles</a>
    {% if object.author == request.user.profile %}
      <a href="{% url 'blog:article_update' object.pk %}" class="back-button">✏️ Edit Article</a>
    {% else %}
      <div></div>  {# empty to keep spacing #}
    {% endif %}
  </div>

  <h1 class="article-title">{{ object.title }}</h1>

  <div class="category-tag">{{ object.category.name }}</div>

  <div class="dates-container">
    <div><strong>Created:</strong> {{ object.created_on|date:"F j, Y, g:i a" }}</div>
    <div>
      {% if object.created_on|date:"Y-m-d H:i" != object.updated_on|date:"Y-m-d H:i" %}
        <strong>Updated:</strong> {{ object.updated_on|date:"F j, Y, g:i a" }}
      {% endif %}
    </div>
  </div>

  {% if object.header_img %}
    <div class="article-header-image">
      <img src="{{ object.header_img.url }}" alt="Header Image">
    </div>
  {% endif %}

  <div class="author-info">
    <strong>Written by:</strong> {{ object.author }}
  </div>

  <div class="article-body">
    <p>{{ object.entry|linebreaksbr }}</p>
  </div>

  <h2 style="text-align: center; margin-bottom: 20px;">Want to see more like this?</h2>
  <div class="commissions-list">
    {% for article in other_articles %}
      <div class="commission-box">
        <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
      </div>
    {% empty %}
      <p style="text-align: center;">It seems the author has no other articles.</p>
    {% endfor %}
  </div>

  <h1 style="text-align: center; margin-bottom: 20px;">Comments</h1>

  {% if user.is_authenticated %}
    <form method="post">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Submit</button>
    </form>
  {% else %}
    <p style="text-align: center;"><a href="{% url 'accounts:login' %}">Log in</a> to leave a comment.</p>
  {% endif %}

  <div class="comments">
    {% for comment in comments %}
      <div class="comment-box">
        <p><strong>{{ comment.author }}</strong> <span class="timestamp">| {{ comment.created_on|date:"F j, Y, g:i a" }}</span></p>
        <p>{{ comment.entry|linebreaksbr }}</p>
      </div>
    {% empty %}
      <p>No comments yet.</p>
    {% endfor %}
  </div>

{% elif view_type == 'create' or view_type == 'update' %}
  <h1 style="text-align: center; margin-bottom: 20px;">
    {% if view_type == 'create' %}
      Create New Article
    {% else %}
      Edit Article
    {% endif %}
  </h1>
  <form method="post" enctype="multipart/form-data" style="max-width:700px; margin: 0 auto;">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">
      {% if view_type == 'create' %}
        Publish
      {% else %}
        Update
      {% endif %}
    </button>
  </form>
  <div style="max-width:700px; margin: 10px auto 40px auto; text-align: center;">
    <a href="{% url 'blog:article_list' %}" class="back-button">← Back to Articles</a>
  </div>
{% endif %}
{% endblock %}
